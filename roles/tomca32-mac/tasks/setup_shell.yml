---
- name: Get Zsh Path
  ansible.builtin.shell: which zsh
  register: which_zsh

- name: Save Zsh path to variable
  ansible.builtin.set_fact:
    zsh_path: '{{ which_zsh.stdout }}'

- name: Add Zsh to /etc/shells
  become: yes
  become_user: root
  ansible.builtin.lineinfile:
    path: /etc/shells
    state: present
    line: '{{ zsh_path }}'

- name: Change Shell to zsh
  ansible.builtin.shell: chsh -s $(which zsh) $(whoami)
...